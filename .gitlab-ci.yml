image: "spritecloud/ruby-selenium-runner:2.4"

services:
  - selenium/standalone-chrome:3.8.1

variables:
  SELENIUM_URL: "http://selenium__standalone-chrome:4444/wd/hub/"
  API_KEY: ODU2OWI3Njk5MjhjNTEzMWQ4MDA0M2U4YzBkMTZkNjVlNmJlNTBjNTcxNDZlOTAyMTU3OTViMWQyNTBkODFjODEz
  PROFILE_ID: 13

before_script:
  - bundle install #Install the required gems

script-upload-example:
  script:
  - bundle exec cucumber -f json -o ./results/latest_results.json
  - sh upload_results_to_calliope.sh ./results/latest_results.json
  when: manual

curl-upload-example:
  script:
    - bundle exec cucumber -f json -o ./results/latest_results.json
    - curl -X POST -H "x-api-key:$API_KEY" -H "Content-Type:application/*" --data "@results/latest_results.json" https://app.calliope.pro/api/v2/profile/$PROFILE_ID/testreport?os=myos&platform=myplatform&build=mybuild
  when: manual

curl-upload-example-custom:
  variables:
    API_KEY: ODU2OWI3Njk5MjhjNTEzMWQ4MDA0M2U4YzBkMTZkNjVlNmJlNTBjNTcxNDZlOTAyMTU3OTViMWQyNTBkODFjODEz
    API_URL: "https://test.calliope.pro"
  script:
    - bundle exec cucumber -f json -o ./results/latest_results.json
    - curl -X POST -H "x-api-key:$API_KEY" -H "Content-Type:application/*" --data "@results/latest_results.json" $API_URL/api/v2/profile/$PROFILE_ID/testreport?os=myos&platform=myplatform&build=mybuild
  when: manual
