image: "spritecloud/ruby-selenium-runner:2.6"

services:
  - selenium/standalone-chrome:3.8.1

variables:
  SELENIUM_URL: "http://selenium__standalone-chrome:4444/wd/hub/"
  API_KEY: ODU2OWI3Njk5MjhjNTEzMWQ4MDA0M2U4YzBkMTZkNjVlNmJlNTBjNTcxNDZlOTAyMTU3OTViMWQyNTBkODFjODEz
  PROFILE_ID: 735

before_script:
  - bundle install #Install the required gems

curl-upload-example:
  script:
    - bundle exec cucumber -f json -o ./results/latest_results.json && true
    - >
    curl -X POST
    -H "x-api-key:$API_KEY"
    -H "Content-Type:multipart/form-data"
    -F "file[]=@results/latest_results.json"
    "https://app.calliope.pro/api/v2/profile/$PROFILE_ID/report/import?os=myos&platform=myplatform&build=mybuild"
  when: manual

curl-upload-example-test-env:
  script:
    - bundle exec cucumber -f json -o ./results/latest_results.json && true
    - >
    curl -X POST
    -H "x-api-key:$API_KEY"
    -H "Content-Type:application/*"
    -F "file[]=@results/latest_results.json"
    "https://test.calliope.pro/api/v2/profile/$PROFILE_ID/report/import?os=myos&platform=myplatform&build=mybuild"
  when: manual
